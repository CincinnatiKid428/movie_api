<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: auth.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: auth.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>//File: /auth.js

const jwtSecret = 'your_jwt_secret'; // Must match the key used in the JWTStrategy

const jwt = require('jsonwebtoken');
const passport = require('passport');

require('./passport.js'); // Local passport file


/**
 * Generates a JSON Web Token (JWT) for a given user.
 * @private
 * @param {Object} user - The user object to encode into the token
 * @param {string} user.Username - The username of the user
 * @returns {string} The signed JWT token
 */
let generateJWTToken = (user) => {
  return jwt.sign(user, jwtSecret, {
    subject: user.Username, // Username to encode in the JWT
    expiresIn: '7d',        // Specifies token expiration: 7 days
    algorithm: 'HS256'      // Algorithm used to sign/encode the values of the JWT
  });
}


/* Login endpoint - POST method */

module.exports = (router) => {

  /**
   * Sends HTTP POST request to authenticate user.
   * @function loginUser
   * @param {Object} req - Express request object
   * @param {Object} res - Express response object
   * @returns {void} `return` sends response
   * @example Route: POST /login
   * @example Response Object:
   * ```json
   *   {
   *       "user": {
   *           "_id": "68caf703442939d1fb7a013a",
   *           "Username": "Test123",
   *           "Password": "$2b$10$EUN1sp/Qg0XQnwvTZwwM8.fl8GZVRFmuwJ8x6V3VJraFeZsGwKMLG",
   *           "Email": "Email123@email.com",
   *           "Birthdate": "2001-01-19T00:00:00.000Z",
   *           "FavoriteMovies": [],
   *           "__v": 0
   *       },
   *       "token": "eyJhbGczI1NiIsInR5pXVaWQiOiRlc3QxMjMd2QywWFmwlydwMDowMC4wMFtdLCJfX3YiOjATc1O"
   *   }
   * ```
   */
  function loginUser(req, res) {
    passport.authenticate('local', { session: false }, (error, user, info) => {
      if (error || !user) {
        return res.status(400).json({
          message: 'Could not authenticate.',
          user: user
        });
      }
      req.login(user, { session: false }, (error) => {
        if (error) {
          res.send(error);
        }
        let token = generateJWTToken(user.toJSON());
        return res.json({ user, token });
      });
    })(req, res);
  }
  router.post('/login', loginUser);
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addFavMovie">addFavMovie</a></li><li><a href="global.html#checkValidationResults">checkValidationResults</a></li><li><a href="global.html#deleteFavMovie">deleteFavMovie</a></li><li><a href="global.html#deleteUser">deleteUser</a></li><li><a href="global.html#getAllMovies">getAllMovies</a></li><li><a href="global.html#getApiHtmlDoc">getApiHtmlDoc</a></li><li><a href="global.html#getDirectorByName">getDirectorByName</a></li><li><a href="global.html#getGenreByName">getGenreByName</a></li><li><a href="global.html#getMovieByTitle">getMovieByTitle</a></li><li><a href="global.html#loginUser">loginUser</a></li><li><a href="global.html#registerNewUser">registerNewUser</a></li><li><a href="global.html#updateUserInfo">updateUserInfo</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Sun Sep 21 2025 19:59:07 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
